{% extends "base.html" %}

{% load thumbnail %}
{% load gravatar %}

{% block heading %}
{{hardware.name}}
{% endblock %}

{% block script %}
function openlightbox (url) {
	$('#lightboximage').attr("src", url)
	$('#Lightbox').lightbox();
}
{% endblock %}

{% block content %}

<hr>

<div class="span3">

<div id="myCarousel" class="carousel slide" data-interval="20000">
  <!-- Carousel items -->
  <div class="carousel-inner">
{% for image in images %}
{% thumbnail image.image "300x400" crop="center"  as im %}
    <div class="{% if forloop.first %}active {% endif %}item"><div class="wrapper"><a  href="javascript:openlightbox('/images/hardware/{{image.filename}}')"class="lightboxbutton"><img src="{{ im.url }}" class="img">
	{% endthumbnail %}		    
    <div class='description'>  
        <!-- description content -->  
        <p class='description_content'>{{image.caption}}</p>  
        <!-- end description content -->  
    </div></a></div></div>
{% endfor %}
  </div>

  <!-- Carousel nav -->
  <a class="carousel-control left" href="#myCarousel" data-slide="prev">&lsaquo;</a>
  <a class="carousel-control right" href="#myCarousel" data-slide="next">&rsaquo;</a>
</div>
<div class="lightbox fade" id="Lightbox" style="display: none;">
			    <div class='lightbox-content'>
			    <img class="img-polaroid" id="lightboximage">
			    </div>
			    </div>
</div>
<div class="span6">
  <p class="well" style="font-size: 15px;font-weight: 200;line-height: 20px;">{{hardware.description}}</p>
	<div class="row">
	  <div class="span5">
	  	<h4>Details</h4>
		<table class="table table-condensed">
			<tr><th>Zustand</th><td>{{hardware.condition}}</td><tr>
			<tr><th>Art</th><td>{{hardware.state}}</td><tr>
            <tr><th>Gerätetyp</th><td><img src="/images/{{hardware.category.icon}}" />{{hardware.category}}</td><tr>
			<tr><th>Verfügbarkeit</th><td>{% if hardware.availability %}
<span class="badge badge-success"><i class="icon-ok-sign icon-white"></i></span>
{% else %}
<span class="badge badge-important"><i class="icon-remove-sign icon-white"></i></span>
{% endif %}</td></tr>
			<tr><th>Verliehen an</th><td>{{hardware.lent_to}}</td><tr>
			{% if distance %}
			<tr><th>Entfernung</th><td>{{distance}}</td><tr>
			{% endif%}
		</table>

			<!--p>City: {{hardware.location.city}}</p-->
			<!--p>Postcode: {{hardware.location.postcode}}</p-->
			<!--p>Street: {{hardware.location.street}}</p-->
		</div>
		
	</div>
	<div class="row">
		<div class="span5">
			{% if showmap %}
				<h4>Karte</h4>
				{{ map.map }}
				{{ map.media.js }}
			{% endif %}
		</div>
	</div>
</div>

{% if user.is_authenticated %}
<div class="span2">
	{% if user != hardware.owner %}
	<h4 style="margin-left:4px">Eintrag von <a href="{% url users.views.profile hardware.owner %}">{{hardware.owner.get_profile.displayname }}</a></h4>
	{% if hardware.owner.get_profile.mail_confirmed %}
	    	<img src="{% gravatar_url hardware.owner.email 200 %}" class="img-polaroid"style="margin-bottom:6px">
	    	{% else %}
	    	<img src="{% gravatar_url "" 200 %}" class="img-polaroid" style="margin-bottom:6px">
	    	{% endif %}
	<a class="btn btn-success btn-block" href="{% url hardware.views.sendMail hardware.id %}" style="margin:4px"><i class="icon-envelope icon-white"></i> Kontakt aufnehmen</a>
	<a class="btn btn-danger btn-block" href="#abuseModal" role="button" data-toggle="modal" style="margin:4px"><i class="icon-ban-circle icon-white"></i> Missbrauch melden</a>
	{% else %}
	<h4 style="margin-left:4px">Ohai, it's you :)</h4>
	{% if hardware.owner.get_profile.mail_confirmed %}
	    	<img src="{% gravatar_url hardware.owner.email 200 %}" class="img-polaroid"style="margin-bottom:6px">
	{% else %}
	    	<img src="{% gravatar_url "" 200 %}" class="img-polaroid"style="margin-bottom:6px">
	{% endif %}
	<a class="btn btn-primary btn-block" href="{% url hardware.views.hardwareEdit hardware.id %}" style="margin:4px"><i class="icon-edit icon-white"></i> Eintrag bearbeiten</a>
	{% if hardware.state.temporary and hardware.availability %}
	<a class="btn btn-block" href="#lendModal" role="button" data-toggle="modal" style="margin:4px"><i class="icon-ok"></i> Eintrag verleihen</a>
	{% elif hardware.state.temporary %}
	<a class="btn btn-block" href="#takebackModal" role="button" data-toggle="modal" style="margin:4px"><i class="icon-ok"></i> Eintrag zurücknehmen</a>
	{% endif %}
	<a href="#deleteModal" role="button" class="btn btn-danger btn-block" data-toggle="modal" style="margin:4px"><i class="icon-trash icon-white"></i> Eintrag löschen</a>
<!-- Modal -->
<div id="deleteModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
<h3 id="deleteModalLabel">Wirklich löschen?</h3>
</div>
<div class="modal-body">
<p>Möchtest du die Hardware wirklich löschen? Dieser Schritt kann nicht rückgängig gemacht werden.</p>
</div>
<div class="modal-footer">
    <a href="#" class="btn" data-dismiss="modal">Abbrechen</a>
    <a class="btn btn-danger" href="{% url hardware.views.deleteHardware hardware.id %}">Löschen</a>
</div>
</div>

<div id="lendModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="lendModalLabel" aria-hidden="true">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
<h3 id="lendModalLabel">An wen soll der Eintrag verliehen werden?</h3>
</div>
<form action="{% url hardware.views.giveaway %}" method="post" class="form-inline">{% csrf_token %}
<div class="modal-body">
	<p>Gib bitte den Benutzernamen des/der Benutzers/Benutzerin an, an den/die du den Eintrag verleihen möchtest. Falls die Person dir bereits eine Kontaktmail geschickt hat, taucht der Name im Autocomplete auf.</p>
		<div class="control-group {{form.username.css_classes}}">
		<div class="controls">
			<input id="id_username" type="text" name="username" maxlength="200"  class="typeahead input-block-level" data-provide="typeahead" data-source="['test', 'test2']"/>
		<span class="help-inline">{{form.username.errors}}</span>
		</div>
		</div>
</div>
<div class="modal-footer">
<input type="hidden" name="hardware" value="{{hardware.id}}">
    <a href="#" class="btn" data-dismiss="modal">Abbrechen</a>
    <button type="submit" class="btn btn-primary">Verleihen</button>
</div>
</form>
<script type="text/javascript">
$("#id_username").keypress( function() {
	if ($(this).val().length >= 2) {
		Dajaxice.users.get_users_to_lend(Dajax.process, {'query':$(this).val()});
	}
});
</script>
</div>

<div id="takebackModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="takebackModalLabel" aria-hidden="true">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
<h3 id="deleteModalLabel">Hardware zurücknehmen?</h3>
</div>
<div class="modal-body">
<p>Die Hardware ist wieder sicher bei dir angekommen und du möchtest sie wieder für andere verfügbar machen?</p>
</div>
<div class="modal-footer">
    <a href="#" class="btn" data-dismiss="modal">Abbrechen</a>
    <a class="btn btn-danger" href="{% url hardware.views.takeback hardware.id %}">Zurück nehmen</a>
</div>
</div>



	{% endif %}
<div id="abuseModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="abuseModalLabel" aria-hidden="true">
<div class="modal-header">
<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
<h3 id="abuseModalLabel">Missbrauch melden</h3>
</div>
<form action="{% url main.views.hardwareAbuse %}" method="post" class="form-inline">{% csrf_token %}
<div class="modal-body">
	<p>Gib bitte eine Begründung an, warum du einen Missbrauch vermutest.</p>
		<div class="control-group">
			<label class="control-label" for="id_caption3">Beschreibung</label>
			<div class="controls">
				<textarea rows="4"  class="input-block-level" id="id_description" name="description"></textarea>
			</div>
		</div>
</div>
<div class="modal-footer">
<input type="hidden" name="object" value="{{hardware.id}}">
    <a href="#" class="btn" data-dismiss="modal">Abbrechen</a>
    <button type="submit" class="btn btn-primary">Abschicken</button>
</div>
</form>
</div>

{% endif %}
</div>
{% endblock %}
